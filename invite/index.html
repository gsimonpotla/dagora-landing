<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Open Dagora</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;padding:2rem;line-height:1.5}</style>
</head>
<body>
  <h1>Opening Dagora…</h1>
  <p>If nothing happens, <a id="open">tap to open</a> or <a id="store" href="#">get the app</a>.</p>

  <script>
    const qs = new URLSearchParams(location.search);
    const token = qs.get('token') || '';
    const playStore = 'https://play.google.com/store/apps/details?id=com.dagora.app';
    const appStore  = 'https://apps.apple.com/app/idAPPLE_APP_ID'; // TODO: replace

    const appScheme = 'dagora://invite' + (token ? ('?token=' + encodeURIComponent(token)) : '');

    const isAndroid = /Android/i.test(navigator.userAgent);
    const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);

    function toStore() { location.replace(isIOS ? appStore : playStore); }

    function openApp() {
      if (isAndroid) {
        // Chrome intent with fallback directly to Play Store if app is missing
        const intent = 'intent://invite' + (token ? ('?token=' + encodeURIComponent(token)) : '') +
          '#Intent;scheme=dagora;package=com.dagora.app;S.browser_fallback_url=' +
          encodeURIComponent(playStore) + ';end';
		  
		location.href = intent;
      } else if (isIOS) {
        // Try custom scheme, then App Store after a short delay
        const start = Date.now();
        location.href = appScheme;
        setTimeout(() => { if (Date.now() - start < 1500) toStore(); }, 1200);
      } else {
        // Desktop or unknown → show store choice; default to Play Store
        toStore();
      }
    }

    document.getElementById('open').onclick = (e) => { e.preventDefault(); openApp(); };
    document.getElementById('store').onclick = (e) => { e.preventDefault(); toStore(); };

    // Auto-attempt on load
    openApp();
  </script>
</body>
</html>
